# 은하 분류기 GUI 사용 설명서

## 개요
이 프로그램은 은하 이미지를 분류하는 딥러닝 모델을 **학습**하고 **예측**할 수 있는 통합 GUI를 제공합니다.

## 실행 방법

### 1. GUI 모드로 실행
```bash
python galaxy.py --mode gui
```

체크포인트가 있는 경우:
```bash
python galaxy.py --mode gui --checkpoint outputs/best_model.pt
```

## 주요 기능

### 📚 학습 탭 (Training Tab)

#### 학습 설정
- **데이터셋 경로**: 학습 데이터가 있는 폴더 선택
  - 구조: `dataset/train/Spiral/`, `dataset/train/Elliptical/` 등
- **Epochs**: 학습 반복 횟수 (기본값: 30)
- **Batch Size**: 배치 크기 (기본값: 32)
- **Learning Rate**: 학습률 (기본값: 0.0003)
- **백본**: 모델 아키텍처 선택 (resnet18/resnet34)
- **이미지 크기**: 입력 이미지 크기 (기본값: 224)
- **혼합 정밀도 (AMP)**: GPU 메모리 절약 및 속도 향상
- **출력 경로**: 학습 결과 저장 위치

#### 학습 실행
1. 설정 완료 후 **"학습 시작"** 버튼 클릭
2. 학습 로그 실시간 확인
3. Loss/Accuracy 그래프 실시간 업데이트
4. **"중지"** 버튼으로 언제든지 중단 가능

#### 학습 결과
학습 완료 후 `outputs/` 폴더에 저장:
- `best_model.pt`: 최고 성능 모델
- `labels.json`: 클래스 정보
- `training_log.json`: 학습 기록
- `curve_loss.png`: Loss 곡선
- `curve_acc.png`: Accuracy 곡선
- `report.html`: 종합 리포트

### 🔍 예측 탭 (Prediction Tab)

#### 단일 이미지 예측
1. **"이미지 열기"** 버튼으로 이미지 선택
2. **"예측"** 버튼 클릭
3. 결과 확인:
   - 이미지 미리보기
   - 클래스별 확률 테이블
   - 확률 바 차트

#### 폴더 예측
1. **"폴더 열기"** 버튼으로 폴더 선택
2. **"예측"** 버튼 클릭
3. 폴더 내 모든 이미지 자동 예측

#### 예측 강화 학습 (Reinforcement Learning)
예측 후 모델 성능을 향상시키기 위한 피드백 제공:

**✓ 정답 버튼**
- 예측이 맞을 때 클릭
- 해당 이미지를 예측된 클래스의 학습 데이터에 자동 추가
- 향후 재학습 시 모델 신뢰도 향상

**✗ 오답 버튼**
- 예측이 틀렸을 때 클릭
- 올바른 클래스 선택 대화상자 표시
- 선택한 클래스로 학습 데이터에 추가
- 오분류 패턴 학습으로 정확도 개선

**피드백 로그**
- 모든 피드백이 `outputs/feedback_log.json`에 기록
- 재학습 시 어떤 데이터가 추가되었는지 추적 가능

#### 체크포인트 로드
- **"체크포인트 로드"** 버튼으로 학습된 모델 불러오기
- 학습 탭에서 학습한 모델은 자동으로 예측 탭에서 사용 가능

## 데이터셋 구조

학습을 위한 데이터셋 구조:
```
dataset/
├── train/
│   ├── Spiral/
│   │   ├── image1.jpg
│   │   ├── image2.jpg
│   │   └── ...
│   ├── Elliptical/
│   │   ├── image1.jpg
│   │   └── ...
│   └── Irregular/
│       └── ...
├── val/  (선택사항, 없으면 train에서 자동 분할)
└── test/ (선택사항)
```

**📁 자동 폴더 생성**
- `dataset/` 폴더가 없으면 자동으로 생성하고 안내 메시지 표시
- `train/` 폴더가 없으면 자동으로 생성하고 구조 안내
- `outputs/` 폴더는 학습 시작 시 자동 생성
- 클래스 폴더와 이미지는 사용자가 직접 준비해야 함

## 워크플로우 예시

### 시나리오 1: 처음부터 학습하기
1. GUI 실행: `python galaxy.py --mode gui`
2. **학습 탭** 선택
3. 데이터셋 경로 설정 (예: `./dataset`)
4. 하이퍼파라미터 조정 (필요시)
5. **"학습 시작"** 클릭
6. 학습 완료 후 자동으로 예측 탭에서 사용 가능

### 시나리오 2: 기존 모델로 예측하기
1. GUI 실행: `python galaxy.py --mode gui --checkpoint outputs/best_model.pt`
2. **예측 탭** 선택
3. 이미지 또는 폴더 선택
4. **"예측"** 클릭

### 시나리오 3: 추가 학습 (Fine-tuning)
1. GUI 실행: `python galaxy.py --mode gui`
2. **학습 탭**에서 **"체크포인트 로드"** 클릭
3. 기존 모델 선택
4. 새로운 데이터로 학습 시작

### 시나리오 4: 예측 피드백으로 모델 개선
1. GUI 실행 및 모델 로드
2. **예측 탭**에서 이미지 예측
3. 예측 결과 확인:
   - 맞으면: **✓ 정답** 클릭 → 데이터 자동 추가
   - 틀리면: **✗ 오답** 클릭 → 올바른 클래스 선택 → 데이터 추가
4. 충분한 데이터 수집 후 **학습 탭**에서 재학습
5. 개선된 모델로 더 정확한 예측!

## CLI 모드 (기존 기능)

### 학습
```bash
python galaxy.py --mode train --data_dir ./dataset --epochs 30 --batch_size 32
```

### 평가
```bash
python galaxy.py --mode eval --data_dir ./dataset --checkpoint outputs/best_model.pt
```

### 예측
```bash
python galaxy.py --mode predict --checkpoint outputs/best_model.pt --input ./test_image.jpg --show_probs
```

## 팁 & 주의사항

### 학습 팁
- 🎯 **적절한 Epoch 수**: 30-50 epoch가 일반적으로 좋은 결과
- 💾 **배치 크기**: GPU 메모리에 따라 조정 (메모리 부족 시 줄이기)
- 📊 **과적합 확인**: Val Loss가 증가하면 조기 종료 고려
- ⚡ **AMP 사용**: NVIDIA GPU 사용 시 학습 속도 2배 향상

### 예측 팁
- 📸 **이미지 품질**: 학습 데이터와 유사한 품질의 이미지 사용
- 🎨 **전처리**: 프로그램이 자동으로 224x224 크기로 조정
- 📁 **배치 예측**: 폴더 선택으로 여러 이미지 한 번에 예측
- 🔄 **강화 학습**: 예측 후 피드백 제공으로 모델 지속 개선
- 📊 **데이터 축적**: 정답/오답 피드백이 자동으로 학습 데이터 증강

### 주의사항
- ⚠️ **학습 중 중지**: 중지 버튼 클릭 후 현재 epoch 완료까지 대기
- 💾 **모델 저장**: 최고 성능 모델만 자동 저장됨
- 🔄 **메모리**: 대용량 데이터셋 사용 시 충분한 RAM 필요

## 트러블슈팅

### Q: "train 폴더가 필요합니다" 오류
**A**: 이제 자동으로 폴더가 생성됩니다! 안내 메시지에 따라 클래스 폴더를 만들고 이미지를 넣으세요.

### Q: "클래스 폴더가 없습니다" 오류
**A**: `dataset/train/` 안에 클래스별 폴더를 만드세요:
- `dataset/train/Spiral/` - 나선 은하 이미지들
- `dataset/train/Elliptical/` - 타원 은하 이미지들
- `dataset/train/Irregular/` - 불규칙 은하 이미지들

### Q: GPU 메모리 부족 오류
**A**: Batch Size를 줄이거나 이미지 크기를 낮추세요.

### Q: 학습이 시작되지 않음
**A**: 
1. 데이터셋 경로 확인
2. train 폴더 내 클래스 폴더 확인 (자동 안내됨)
3. 각 클래스 폴더에 이미지 파일이 있는지 확인

### Q: 예측 시 "모델을 로드해주세요" 오류
**A**: 예측 탭에서 "체크포인트 로드" 버튼으로 모델을 먼저 불러오세요.

## 문의 및 지원
문제 발생 시 학습 로그와 오류 메시지를 확인하세요.
